{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>{{ quiz.title }}</h2>
<p>{{ quiz.description }}</p>
<p>Time: <span id="timer">{{ quiz.duration }}:00</span> minutes</p>

<form method="post" action="{% url 'submit_quiz' quiz.id %}">
  {% csrf_token %}
  {% for question in quiz.questions.all %}
    <div class="card mb-3 p-2">
      <p><strong>Q{{ forloop.counter }}:</strong> {{ question.question_text }}</p>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="1" required>
        <label class="form-check-label">A) {{ question.option1 }}</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="2">
        <label class="form-check-label">B) {{ question.option2 }}</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="3">
        <label class="form-check-label">C) {{ question.option3 }}</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q{{ question.id }}" value="4">
        <label class="form-check-label">D) {{ question.option4 }}</label>
      </div>
    </div>
  {% endfor %}

  <button type="submit" class="btn btn-primary">Submit Quiz</button>
</form>

<script>
// Timer countdown
let duration = {{ quiz.duration }} * 60; // in seconds
let timer = document.getElementById('timer');

let countdown = setInterval(function() {
    let minutes = Math.floor(duration / 60);
    let seconds = duration % 60;
    timer.textContent = minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
    duration--;
    if(duration < 0){
        clearInterval(countdown);
        alert('Time is up! Submitting quiz.');
        document.querySelector('form').submit();
    }
}, 1000);
</script>
{% endblock %}
